<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= pageTitle %> - Bikers Portal</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <style>
    .listings-section {
      padding: 60px 0;
      background-color: #f8f9fa;
    }
    
    .section-header {
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .section-title {
      font-size: 2rem;
      color: #333;
    }
    
    .empty-list {
      text-align: center;
      padding: 50px 0;
    }
    
    .empty-list-icon {
      font-size: 3rem;
      color: #ccc;
      margin-bottom: 20px;
    }
    
    .empty-list h3 {
      font-size: 1.5rem;
      color: #333;
      margin-bottom: 15px;
    }
    
    .empty-list p {
      color: #666;
      margin-bottom: 25px;
    }
    
    .listings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
    }
    
    .listing-card {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      position: relative;
    }
    
    .listing-image {
      height: 200px;
      position: relative;
      overflow: hidden;
    }
    
    .listing-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    
    .listing-card:hover .listing-image img {
      transform: scale(1.05);
    }
    
    .listing-badge {
      position: absolute;
      top: 15px;
      left: 15px;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    .badge-active {
      background-color: #28a745;
      color: #fff;
    }
    
    .badge-pending {
      background-color: #ffc107;
      color: #212529;
    }
    
    .badge-sold {
      background-color: #dc3545;
      color: #fff;
    }
    
    .listing-content {
      padding: 20px;
    }
    
    .listing-title {
      font-size: 1.25rem;
      margin-bottom: 10px;
      color: #333;
    }
    
    .listing-price {
      font-size: 1.25rem;
      font-weight: 700;
      color: #0084ff;
      margin-bottom: 15px;
    }
    
    .listing-details {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
      font-size: 0.9rem;
      color: #666;
    }
    
    .listing-detail {
      display: flex;
      align-items: center;
    }
    
    .listing-detail i {
      margin-right: 5px;
    }
    
    .listing-stats {
      display: flex;
      justify-content: space-between;
      padding-top: 15px;
      border-top: 1px solid #eee;
      font-size: 0.9rem;
      color: #666;
    }
    
    .listing-stat {
      display: flex;
      align-items: center;
    }
    
    .listing-stat i {
      margin-right: 5px;
    }
    
    .listing-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .listing-actions .btn {
      flex: 1;
      font-size: 0.9rem;
      padding: 8px 0;
    }
    
    .listing-badge.badge-featured {
      background-color: #ff6b35;
      color: #fff;
      right: 15px;
      left: auto;
    }
    
    .pagination-container {
      margin-top: 40px;
      display: flex;
      justify-content: center;
    }
    
    @media (max-width: 576px) {
      .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .listings-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <nav class="navbar">
        <a href="/dashboard" class="logo"><i class="fas fa-motorcycle"></i> BikersPortal</a>
        
        <button class="mobile-menu-toggle">
          <i class="fas fa-bars"></i>
        </button>
        
        <ul class="menu">
          <li class="menu-item"><a href="/bikes" class="menu-link">Motorcycles</a></li>
          <li class="menu-item"><a href="/services" class="menu-link">Services</a></li>
          <li class="menu-item"><a href="/sell" class="menu-link">Sell</a></li>
          <li class="menu-item dropdown">
            <a href="#" class="menu-link dropdown-toggle">
              <i class="fas fa-user-circle"></i> <%= currentUser ? currentUser.firstName : 'User' %>
            </a>
            <ul class="dropdown-menu">
              <li><a href="/dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
              <li><a href="/dashboard/profile"><i class="fas fa-user"></i> My Profile</a></li>
              <li><a href="/auth/logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Listings Section -->
  <section class="listings-section">
    <div class="container">
      <div class="section-header">
        <h1 class="section-title"><%= pageTitle %></h1>
        <a href="/sell" class="btn btn-primary">
          <i class="fas fa-plus"></i> Add New Listing
        </a>
      </div>
      
      <% if (bikes && bikes.length > 0) { %>
        <div class="listings-grid">
          <% bikes.forEach(bike => { %>
            <div class="listing-card">
              <div class="listing-image">
                <img src="<%= bike.thumbnailImage || (bike.images && bike.images.length > 0 ? bike.images[0] : '/images/placeholder-bike.jpg') %>" 
                     alt="<%= bike.title %>"
                     onerror="this.onerror=null; this.src='/images/default-bike.jpg';">
                <div class="listing-badge badge-<%= bike.status.toLowerCase() %>"><%= bike.status %></div>
                <% if (bike.isFeatured) { %>
                  <div class="listing-badge badge-featured">Featured</div>
                <% } %>
              </div>
              <div class="listing-content">
                <h3 class="listing-title"><%= bike.title %></h3>
                <div class="listing-price">â‚¹<%= bike.price.toLocaleString() %></div>
                <div class="listing-details">
                  <div class="listing-detail">
                    <i class="fas fa-calendar-alt"></i> <%= bike.year %>
                  </div>
                  <div class="listing-detail">
                    <i class="fas fa-tachometer-alt"></i> <%= bike.mileage.toLocaleString() %> km
                  </div>
                  <div class="listing-detail">
                    <i class="fas fa-cog"></i> <%= bike.engineCapacity %> cc
                  </div>
                </div>
                <div class="listing-stats">
                  <div class="listing-stat">
                    <i class="fas fa-eye"></i> <%= bike.views || 0 %> views
                  </div>
                  <div class="listing-stat">
                    <i class="fas fa-calendar"></i> Listed <%= new Date(bike.createdAt).toLocaleDateString() %>
                  </div>
                </div>
                <div class="listing-actions">
                  <a href="/bikes/<%= bike._id %>" class="btn btn-outline">View</a>
                  <a href="/bikes/<%= bike._id %>/edit" class="btn btn-primary">Edit</a>
                  <button class="btn btn-danger delete-listing" data-id="<%= bike._id %>">Delete</button>
                </div>
              </div>
            </div>
          <% }); %>
        </div>
      <% } else { %>
        <div class="empty-list">
          <i class="fas fa-motorcycle empty-list-icon"></i>
          <h3>No Motorcycles Listed Yet</h3>
          <p>You haven't listed any motorcycles for sale. Start selling your bikes today!</p>
          <a href="/sell" class="btn btn-primary btn-lg">Create Your First Listing</a>
        </div>
      <% } %>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-bottom">
        <p>&copy; 2023 BikersPortal. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Modal for Delete Confirmation -->
  <div class="modal" id="deleteModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Confirm Delete</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete this listing? This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline modal-close">Cancel</button>
          <button class="btn btn-danger" id="confirmDelete">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Alert Container -->
  <div id="alert-container" class="alert-container"></div>

  <script src="/js/main.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Handle delete buttons
      const deleteButtons = document.querySelectorAll('.delete-listing');
      const deleteModal = document.getElementById('deleteModal');
      const confirmDeleteBtn = document.getElementById('confirmDelete');
      const modalCloseButtons = document.querySelectorAll('.modal-close');
      
      let listingIdToDelete = null;
      
      // Open delete modal
      deleteButtons.forEach(button => {
        button.addEventListener('click', () => {
          listingIdToDelete = button.getAttribute('data-id');
          deleteModal.classList.add('show');
        });
      });
      
      // Close modal when clicking close buttons
      modalCloseButtons.forEach(button => {
        button.addEventListener('click', () => {
          deleteModal.classList.remove('show');
          listingIdToDelete = null;
        });
      });
      
      // Close modal when clicking outside
      window.addEventListener('click', (e) => {
        if (e.target === deleteModal) {
          deleteModal.classList.remove('show');
          listingIdToDelete = null;
        }
      });
      
      // Handle confirm delete
      if (confirmDeleteBtn) {
        confirmDeleteBtn.addEventListener('click', async () => {
          if (!listingIdToDelete) return;
          
          try {
            const response = await fetch(`/api/bikes/${listingIdToDelete}`, {
              method: 'DELETE',
              headers: {
                'Content-Type': 'application/json'
              }
            });
            
            const data = await response.json();
            
            if (data.success) {
              // Close modal
              deleteModal.classList.remove('show');
              
              // Show success message
              showAlert('success', 'Listing deleted successfully.');
              
              // Remove the listing card from the page
              const listingCard = document.querySelector(`.delete-listing[data-id="${listingIdToDelete}"]`).closest('.listing-card');
              listingCard.remove();
              
              // If no more listings, show empty state
              const listingsGrid = document.querySelector('.listings-grid');
              if (listingsGrid && listingsGrid.children.length === 0) {
                const container = document.querySelector('.container');
                listingsGrid.remove();
                
                const emptyList = document.createElement('div');
                emptyList.className = 'empty-list';
                emptyList.innerHTML = `
                  <i class="fas fa-motorcycle empty-list-icon"></i>
                  <h3>No Motorcycles Listed Yet</h3>
                  <p>You haven't listed any motorcycles for sale. Start selling your bikes today!</p>
                  <a href="/sell" class="btn btn-primary btn-lg">Create Your First Listing</a>
                `;
                
                container.appendChild(emptyList);
              }
            } else {
              throw new Error(data.error || 'Failed to delete listing');
            }
          } catch (error) {
            console.error('Error deleting listing:', error);
            showAlert('error', error.message || 'An error occurred while deleting the listing.');
          }
        });
      }
      
      // Alert function
      function showAlert(type, message) {
        const alertContainer = document.getElementById('alert-container');
        
        if (alertContainer) {
          // Create alert element
          const alertElement = document.createElement('div');
          alertElement.className = `alert alert-${type}`;
          alertElement.innerHTML = `
            <div class="alert-content">
              <i class="alert-icon fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
              <span class="alert-message">${message}</span>
            </div>
            <button class="alert-close">
              <i class="fas fa-times"></i>
            </button>
          `;
          
          // Add alert to container
          alertContainer.appendChild(alertElement);
          
          // Add click event to close button
          const closeButton = alertElement.querySelector('.alert-close');
          if (closeButton) {
            closeButton.addEventListener('click', () => {
              alertContainer.removeChild(alertElement);
            });
          }
          
          // Auto-remove after 5 seconds
          setTimeout(() => {
            if (alertContainer.contains(alertElement)) {
              alertContainer.removeChild(alertElement);
            }
          }, 5000);
        }
      }
    });
  </script>
</body>
</html> 