<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .seller-profile {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    .profile-header {
      display: flex;
      align-items: center;
      gap: 2rem;
      margin-bottom: 2rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .profile-image {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #007bff;
    }
    
    .profile-info {
      flex: 1;
    }
    
    .seller-name {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }
    
    .seller-meta {
      display: flex;
      gap: 1.5rem;
      color: #555;
      margin-bottom: 1rem;
    }
    
    .seller-meta div {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .rating-stars {
      color: #ffc107;
    }
    
    .profile-actions {
      display: flex;
      gap: 1rem;
    }
    
    .btn-follow {
      padding: 0.5rem 1.5rem;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    .btn-follow.following {
      background-color: #6c757d;
    }
    
    .btn-follow:hover {
      background-color: #0056b3;
    }
    
    .profile-tabs {
      margin-bottom: 2rem;
    }
    
    .tab-nav {
      display: flex;
      border-bottom: 1px solid #e0e0e0;
      margin-bottom: 1.5rem;
    }
    
    .tab-button {
      padding: 0.75rem 1.5rem;
      font-weight: 500;
      cursor: pointer;
      border-bottom: 3px solid transparent;
    }
    
    .tab-button.active {
      border-bottom-color: #007bff;
      color: #007bff;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .bikes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
    }
    
    .bike-card {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .bike-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    .bike-image {
      height: 200px;
      width: 100%;
      object-fit: cover;
    }
    
    .bike-details {
      padding: 1rem;
    }
    
    .bike-title {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .bike-price {
      color: #007bff;
      font-weight: 700;
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
    }
    
    .bike-meta {
      display: flex;
      justify-content: space-between;
      color: #666;
      font-size: 0.9rem;
    }
    
    .reviews-list {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    
    .review-card {
      padding: 1.5rem;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
    }
    
    .review-header {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .reviewer-image {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 1rem;
    }
    
    .reviewer-info {
      flex: 1;
    }
    
    .reviewer-name {
      font-weight: 500;
    }
    
    .review-date {
      color: #777;
      font-size: 0.9rem;
    }
    
    .review-rating {
      font-size: 1.1rem;
      color: #ffc107;
      margin-bottom: 0.5rem;
    }
    
    .review-content {
      color: #333;
      line-height: 1.6;
    }
    
    .review-form {
      margin-top: 2rem;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 1.5rem;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .rating-input {
      display: flex;
      gap: 0.5rem;
      font-size: 1.5rem;
    }
    
    .rating-input .fas {
      color: #ccc;
      cursor: pointer;
    }
    
    .rating-input .fas.active {
      color: #ffc107;
    }
    
    textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      resize: vertical;
      min-height: 100px;
    }
    
    .btn-submit {
      padding: 0.75rem 1.5rem;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #777;
    }
    
    .empty-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: #ccc;
    }
    
    @media (max-width: 768px) {
      .profile-header {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
      }
      
      .seller-meta {
        justify-content: center;
      }
      
      .profile-actions {
        justify-content: center;
      }
      
      .bikes-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      }
    }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="container">
      <a href="/" class="logo">Bikers Portal</a>
      <nav class="nav-menu">
        <a href="/dashboard">Dashboard</a>
        <a href="/bikes">Browse Bikes</a>
        <a href="/sellers" class="active">Sellers</a>
        <a href="/services">Services</a>
        <a href="/about">About Us</a>
      </nav>
      <div class="nav-buttons">
        <% if (currentUser) { %>
          <a href="/dashboard" class="btn btn-outline">My Account</a>
          <a href="/logout" class="btn btn-primary">Logout</a>
        <% } else { %>
          <a href="/login" class="btn btn-outline">Login</a>
          <a href="/register" class="btn btn-primary">Register</a>
        <% } %>
      </div>
      <button class="mobile-menu-toggle">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </header>

  <main class="seller-profile">
    <div class="profile-header">
      <% if (seller.profileImage) { %>
        <img src="<%= seller.profileImage %>" alt="<%= seller.firstName %>" class="profile-image">
      <% } else { %>
        <img src="/images/default-profile.jpg" alt="<%= seller.firstName %>" class="profile-image">
      <% } %>
      
      <div class="profile-info">
        <h1 class="seller-name"><%= seller.firstName %> <%= seller.lastName %></h1>
        
        <div class="seller-meta">
          <div>
            <i class="fas fa-map-marker-alt"></i>
            <span><%= seller.location || 'Location not specified' %></span>
          </div>
          <div>
            <i class="fas fa-star"></i>
            <span><%= averageRating.toFixed(1) %> (<%= reviewCount %> reviews)</span>
          </div>
          <div>
            <i class="fas fa-motorcycle"></i>
            <span><%= bikeCount %> bikes</span>
          </div>
          <div>
            <i class="fas fa-user-friends"></i>
            <span><%= seller.followers ? seller.followers.length : 0 %> followers</span>
          </div>
          <div>
            <i class="fas fa-calendar-alt"></i>
            <span>Member since <%= new Date(seller.createdAt).toLocaleDateString('en-US', {year: 'numeric', month: 'long'}) %></span>
          </div>
        </div>
        
        <div class="seller-description">
          <p><%= seller.bio || 'This seller has not added a bio yet.' %></p>
        </div>
        
        <% if (currentUser && currentUser._id !== seller._id) { %>
        <div class="profile-actions">
          <button id="followBtn" class="btn-follow <%= isFollowing ? 'following' : '' %>" data-seller-id="<%= seller._id %>">
            <i class="fas <%= isFollowing ? 'fa-user-minus' : 'fa-user-plus' %>"></i>
            <%= isFollowing ? 'Unfollow' : 'Follow' %>
          </button>
          <a href="/messages/new?recipient=<%= seller._id %>" class="btn btn-outline">
            <i class="fas fa-envelope"></i> Message
          </a>
        </div>
        <% } %>
      </div>
    </div>
    
    <div class="profile-tabs">
      <div class="tab-nav">
        <div class="tab-button active" data-tab="bikes">Bikes (<%= bikeCount %>)</div>
        <div class="tab-button" data-tab="reviews">Reviews (<%= reviewCount %>)</div>
      </div>
      
      <div id="bikes-tab" class="tab-content active">
        <% if (bikes && bikes.length > 0) { %>
          <div class="bikes-grid">
            <% bikes.forEach(bike => { %>
              <div class="bike-card">
                <a href="/bikes/<%= bike._id %>">
                  <% if (bike.images && bike.images.length > 0) { %>
                    <img src="<%= bike.images[0] %>" alt="<%= bike.title %>" class="bike-image">
                  <% } else { %>
                    <img src="/images/default-bike.jpg" alt="<%= bike.title %>" class="bike-image">
                  <% } %>
                  <div class="bike-details">
                    <h3 class="bike-title"><%= bike.title %></h3>
                    <div class="bike-price">₹<%= bike.price.toLocaleString() %></div>
                    <div class="bike-meta">
                      <span><%= bike.year %> • <%= bike.mileage %>km</span>
                      <span><%= new Date(bike.createdAt).toLocaleDateString() %></span>
                    </div>
                  </div>
                </a>
              </div>
            <% }); %>
          </div>
          <% if (bikeCount > 10) { %>
            <div class="text-center mt-4">
              <a href="/bikes?seller=<%= seller._id %>" class="btn btn-outline">View All Bikes</a>
            </div>
          <% } %>
        <% } else { %>
          <div class="empty-state">
            <div class="empty-icon"><i class="fas fa-motorcycle"></i></div>
            <h3>No Bikes Listed</h3>
            <p>This seller has not listed any bikes for sale yet.</p>
          </div>
        <% } %>
      </div>
      
      <div id="reviews-tab" class="tab-content">
        <% if (reviews && reviews.length > 0) { %>
          <div class="reviews-list">
            <% reviews.forEach(review => { %>
              <div class="review-card">
                <div class="review-header">
                  <% if (review.user && review.user.profileImage) { %>
                    <img src="<%= review.user.profileImage %>" alt="<%= review.user.firstName %>" class="reviewer-image">
                  <% } else { %>
                    <img src="/images/default-profile.jpg" alt="Reviewer" class="reviewer-image">
                  <% } %>
                  <div class="reviewer-info">
                    <div class="reviewer-name">
                      <%= review.user ? `${review.user.firstName} ${review.user.lastName}` : 'Anonymous User' %>
                    </div>
                    <div class="review-date">
                      <%= new Date(review.createdAt).toLocaleDateString('en-US', {year: 'numeric', month: 'long', day: 'numeric'}) %>
                    </div>
                  </div>
                </div>
                <div class="review-rating">
                  <% for (let i = 1; i <= 5; i++) { %>
                    <i class="fas fa-star <%= i <= review.rating ? 'active' : '' %>"></i>
                  <% } %>
                </div>
                <div class="review-content">
                  <%= review.comment || 'No comments provided.' %>
                </div>
              </div>
            <% }); %>
          </div>
        <% } else { %>
          <div class="empty-state">
            <div class="empty-icon"><i class="fas fa-comments"></i></div>
            <h3>No Reviews Yet</h3>
            <p>This seller has not received any reviews yet.</p>
          </div>
        <% } %>
        
        <% if (currentUser && currentUser._id !== seller._id) { %>
          <div class="review-form">
            <h3>Leave a Review</h3>
            <form id="reviewForm" data-seller-id="<%= seller._id %>">
              <div class="form-group">
                <label class="form-label">Rating</label>
                <div class="rating-input" id="ratingStars">
                  <i class="fas fa-star" data-rating="1"></i>
                  <i class="fas fa-star" data-rating="2"></i>
                  <i class="fas fa-star" data-rating="3"></i>
                  <i class="fas fa-star" data-rating="4"></i>
                  <i class="fas fa-star" data-rating="5"></i>
                </div>
                <input type="hidden" name="rating" id="ratingInput" value="0">
              </div>
              <div class="form-group">
                <label class="form-label" for="comment">Comment (Optional)</label>
                <textarea name="comment" id="comment" placeholder="Write your review here..."></textarea>
              </div>
              <button type="submit" class="btn-submit">Submit Review</button>
            </form>
          </div>
        <% } %>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-column">
          <h3>Bikers Portal</h3>
          <p>The ultimate marketplace for motorcycle enthusiasts to buy, sell, and find services.</p>
        </div>
        <div class="footer-column">
          <h3>Quick Links</h3>
          <ul>
            <li><a href="/bikes">Bikes</a></li>
            <li><a href="/sellers">Sellers</a></li>
            <li><a href="/services">Services</a></li>
            <li><a href="/about">About Us</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h3>Contact Us</h3>
          <p>Email: info@bikersportal.com</p>
          <p>Phone: +91 1234567890</p>
          <div class="social-icons">
            <a href="#"><i class="fab fa-facebook"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-youtube"></i></a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2023 Bikers Portal. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script src="/js/script.js"></script>
  <script>
    // Tab switching functionality
    document.querySelectorAll('.tab-button').forEach(button => {
      button.addEventListener('click', () => {
        // Remove active class from all tabs
        document.querySelectorAll('.tab-button').forEach(btn => {
          btn.classList.remove('active');
        });
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        
        // Add active class to clicked tab
        button.classList.add('active');
        const tabId = button.getAttribute('data-tab');
        document.getElementById(`${tabId}-tab`).classList.add('active');
      });
    });
    
    // Rating stars functionality
    const ratingStars = document.querySelectorAll('#ratingStars .fas');
    const ratingInput = document.getElementById('ratingInput');
    
    ratingStars.forEach(star => {
      star.addEventListener('mouseover', () => {
        const rating = parseInt(star.getAttribute('data-rating'));
        highlightStars(rating);
      });
      
      star.addEventListener('mouseout', () => {
        const currentRating = parseInt(ratingInput.value);
        highlightStars(currentRating);
      });
      
      star.addEventListener('click', () => {
        const rating = parseInt(star.getAttribute('data-rating'));
        ratingInput.value = rating;
        highlightStars(rating);
      });
    });
    
    function highlightStars(rating) {
      ratingStars.forEach(star => {
        const starRating = parseInt(star.getAttribute('data-rating'));
        if (starRating <= rating) {
          star.classList.add('active');
        } else {
          star.classList.remove('active');
        }
      });
    }
    
    // Review form submission
    const reviewForm = document.getElementById('reviewForm');
    if (reviewForm) {
      reviewForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const sellerId = reviewForm.getAttribute('data-seller-id');
        const rating = document.getElementById('ratingInput').value;
        const comment = document.getElementById('comment').value;
        
        if (rating < 1) {
          alert('Please select a rating');
          return;
        }
        
        try {
          const response = await fetch(`/sellers/${sellerId}/reviews`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ rating, comment })
          });
          
          const data = await response.json();
          
          if (data.success) {
            alert('Review submitted successfully!');
            window.location.reload();
          } else {
            alert(data.message || 'Error submitting review');
          }
        } catch (error) {
          console.error('Error:', error);
          alert('An error occurred while submitting your review');
        }
      });
    }
    
    // Follow/unfollow functionality
    const followBtn = document.getElementById('followBtn');
    if (followBtn) {
      followBtn.addEventListener('click', async () => {
        const sellerId = followBtn.getAttribute('data-seller-id');
        
        try {
          const response = await fetch(`/sellers/${sellerId}/follow`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            }
          });
          
          const data = await response.json();
          
          if (data.success) {
            if (data.following) {
              followBtn.classList.add('following');
              followBtn.innerHTML = '<i class="fas fa-user-minus"></i> Unfollow';
            } else {
              followBtn.classList.remove('following');
              followBtn.innerHTML = '<i class="fas fa-user-plus"></i> Follow';
            }
            
            // Update followers count (simple way without fetching fresh data)
            const followersEl = document.querySelector('.seller-meta div:nth-child(4) span');
            let followersCount = parseInt(followersEl.textContent);
            followersCount = data.following ? followersCount + 1 : followersCount - 1;
            followersEl.textContent = `${followersCount} followers`;
          } else {
            alert(data.message || 'Error processing request');
          }
        } catch (error) {
          console.error('Error:', error);
          alert('An error occurred while processing your request');
        }
      });
    }
  </script>
</body>
</html> 